<!-- Modal Hiệu chuẩn nước -->
<div class="modal fade" id="waterCalibrationModal" tabindex="-1">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-tint"></i> Hiệu chuẩn cảm biến nước
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info">
          <i class="fas fa-info-circle"></i>
          <strong>Hướng dẫn:</strong>
          <ul class="mb-0 mt-2">
            <li>Nhập giá trị hiển thị trên cảm biến nước</li>
            <li>Nhập giá trị thực tế từ đồng hồ nước chuẩn</li>
            <li>Hệ thống sẽ tự động tính hệ số hiệu chuẩn</li>
          </ul>
        </div>

        <!-- Alert cho nước khi không có dữ liệu lastData -->
        <div class="alert alert-warning" id="waterNoDataAlert" style="display: none;">
          <i class="fas fa-exclamation-triangle"></i>
          <strong>Lưu ý:</strong> Chưa có dữ liệu từ cảm biến nước. Hệ số sẽ được tính dựa trên giá trị hiển thị.
        </div>

        <form id="waterCalibrationForm">
          <!-- Giá trị cảm biến thực tế hiện tại (chỉ hiển thị cho nước) -->
          <div class="form-group mb-3" id="currentRawSensorGroup" style="display: none;">
            <label for="currentRawSensorValue" class="form-label">
              <strong>Giá trị cảm biến thực tế hiện tại:</strong>
            </label>
            <div class="input-group">
              <input type="number" class="form-control" id="currentRawSensorValue" name="currentRawSensorValue" 
                     step="0.01" readonly>
              <span class="input-group-text">m³</span>
            </div>
            <div class="form-text">Giá trị thô của cảm biến (đã loại bỏ hệ số cũ)</div>
          </div>

          <div class="form-group mb-3">
            <label for="waterSensorValue" class="form-label">
              <strong>Giá trị cảm biến đang hiển thị:</strong>
            </label>
            <div class="input-group">
              <input type="number" class="form-control" id="waterSensorValue" name="sensorValue" 
                     step="0.01" min="0" placeholder="0.000" required>
              <span class="input-group-text">m³</span>
            </div>
            <div class="form-text">Giá trị của cảm biến nước hiện đang hiển thị</div>
          </div>

          <div class="form-group mb-3">
            <label for="waterActualValue" class="form-label">
              <strong>Giá trị thực tế từ đồng hồ nước:</strong>
            </label>
            <div class="input-group">
              <input type="number" class="form-control" id="waterActualValue" name="actualValue" 
                     step="0.01" min="0" placeholder="0.000" required>
              <span class="input-group-text">m³</span>
            </div>
            <div class="form-text">Giá trị đọc từ đồng hồ nước chuẩn</div>
          </div>

          <!-- Preview Calibration Result -->
          <div id="waterCalibrationPreview" class="calibration-result" style="display: none;">
            <h6><i class="fas fa-calculator"></i> Kết quả tính toán:</h6>
            <div class="result-item">
              <span class="result-label">Hệ số hiệu chuẩn:</span>
              <span class="result-value" id="waterPreviewCalibrationFactor">1.0000</span>
            </div>
            <div class="result-item">
              <span class="result-label">Công thức:</span>
              <span class="result-value" id="waterPreviewFormula">Giá trị thực = Cảm biến × Hệ số</span>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times"></i> Hủy
        </button>
        <button type="button" class="btn btn-settings" onclick="submitWaterCalibration()">
          <i class="fas fa-save"></i> Lưu hiệu chuẩn
        </button>
      </div>
    </div>
  </div>
</div>

<style>
.calibration-result {
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 0.375rem;
  padding: 1rem;
  margin-top: 1rem;
}

.result-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.result-item:last-child {
  margin-bottom: 0;
}

.result-label {
  font-weight: 500;
  color: #495057;
}

.result-value {
  font-weight: 600;
  color: #007bff;
}
</style> 