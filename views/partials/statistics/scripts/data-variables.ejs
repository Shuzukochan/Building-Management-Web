<script>
  const waterHistory = JSON.parse('<%- JSON.stringify(waterHistory || {}) %>');
  const electricHistory = JSON.parse('<%- JSON.stringify(electricHistory || {}) %>');

  // Debug logs ƒë·ªÉ ki·ªÉm tra d·ªØ li·ªáu
  console.log('üîç Debug - Raw data from server:');
  console.log('üíß waterHistory:', waterHistory);
  console.log('‚ö° electricHistory:', electricHistory);
  console.log('üìä Server date ranges:');
  console.log('‚ö° Electric range: <%= fromElectric %> to <%= toElectric %>');
  console.log('üíß Water range: <%= fromWater %> to <%= toWater %>');

  // H√†m t·∫°o 9 th√°ng g·∫ßn nh·∫•t
  function getLast9Months() {
    const months = [];
    const today = new Date();
    for (let i = 8; i >= 0; i--) {
      const d = new Date(today);
      d.setMonth(d.getMonth() - i);
      months.push({
        month: d.getMonth() + 1,
        year: d.getFullYear(),
        monthYear: `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`
      });
    }
    return months;
  }

  // Set Vietnamese locale for browser
  document.documentElement.lang = 'vi';
  
  // Set Vietnamese locale for dayjs FIRST
  dayjs.locale('vi');
  
  // Configure Ant Design locale
  const { ConfigProvider, DatePicker } = antd;
  const { RangePicker } = DatePicker;
  const { createElement: h } = React;
  const { createRoot } = ReactDOM;
  
  // Vietnamese locale for Ant Design - Complete official locale
  const vietnameseLocale = {
    locale: 'vi',
    Pagination: {
      items_per_page: '/ trang',
      jump_to: 'ƒê·∫øn',
      jump_to_confirm: 'x√°c nh·∫≠n',
      page: '',
      prev_page: 'Trang tr∆∞·ªõc',
      next_page: 'Trang sau',
      prev_5: 'V·ªÅ 5 trang tr∆∞·ªõc',
      next_5: 'ƒê·∫øn 5 trang sau',
      prev_3: 'V·ªÅ 3 trang tr∆∞·ªõc',
      next_3: 'ƒê·∫øn 3 trang sau',
    },
    DatePicker: {
      lang: {
        placeholder: 'Ch·ªçn ng√†y',
        yearPlaceholder: 'Ch·ªçn nƒÉm',
        quarterPlaceholder: 'Ch·ªçn qu√Ω',
        monthPlaceholder: 'Ch·ªçn th√°ng',
        weekPlaceholder: 'Ch·ªçn tu·∫ßn',
        rangePlaceholder: ['T·ª´ ng√†y', 'ƒê·∫øn ng√†y'],
        rangeYearPlaceholder: ['T·ª´ nƒÉm', 'ƒê·∫øn nƒÉm'],
        rangeQuarterPlaceholder: ['T·ª´ qu√Ω', 'ƒê·∫øn qu√Ω'],
        rangeMonthPlaceholder: ['T·ª´ th√°ng', 'ƒê·∫øn th√°ng'],
        rangeWeekPlaceholder: ['T·ª´ tu·∫ßn', 'ƒê·∫øn tu·∫ßn'],
        locale: 'vi_VN',
        today: 'H√¥m nay',
        now: 'B√¢y gi·ªù',
        backToToday: 'V·ªÅ h√¥m nay',
        ok: 'X√°c nh·∫≠n',
        clear: 'X√≥a',
        month: 'Th√°ng',
        year: 'NƒÉm',
        timeSelect: 'Ch·ªçn th·ªùi gian',
        dateSelect: 'Ch·ªçn ng√†y',
        weekSelect: 'Ch·ªçn tu·∫ßn',
        monthSelect: 'Ch·ªçn th√°ng',
        yearSelect: 'Ch·ªçn nƒÉm',
        decadeSelect: 'Ch·ªçn th·∫≠p k·ª∑',
        yearFormat: 'YYYY',
        dateFormat: 'DD/MM/YYYY',
        dayFormat: 'DD',
        dateTimeFormat: 'DD/MM/YYYY HH:mm:ss',
        monthBeforeYear: false,
        previousMonth: 'Th√°ng tr∆∞·ªõc (PageUp)',
        nextMonth: 'Th√°ng sau (PageDown)',
        previousYear: 'NƒÉm tr∆∞·ªõc (Control + left)',
        nextYear: 'NƒÉm sau (Control + right)',
        previousDecade: 'Th·∫≠p k·ª∑ tr∆∞·ªõc',
        nextDecade: 'Th·∫≠p k·ª∑ sau',
        previousCentury: 'Th·∫ø k·ª∑ tr∆∞·ªõc',
        nextCentury: 'Th·∫ø k·ª∑ sau',
        shortWeekDays: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],
        shortMonths: ['Th1', 'Th2', 'Th3', 'Th4', 'Th5', 'Th6', 'Th7', 'Th8', 'Th9', 'Th10', 'Th11', 'Th12'],
        weekDays: ['Ch·ªß nh·∫≠t', 'Th·ª© hai', 'Th·ª© ba', 'Th·ª© t∆∞', 'Th·ª© nƒÉm', 'Th·ª© s√°u', 'Th·ª© b·∫£y'],
        months: ['Th√°ng 1', 'Th√°ng 2', 'Th√°ng 3', 'Th√°ng 4', 'Th√°ng 5', 'Th√°ng 6', 'Th√°ng 7', 'Th√°ng 8', 'Th√°ng 9', 'Th√°ng 10', 'Th√°ng 11', 'Th√°ng 12'],
      },
      timePickerLocale: {
        placeholder: 'Ch·ªçn th·ªùi gian',
        rangePlaceholder: ['T·ª´ th·ªùi gian', 'ƒê·∫øn th·ªùi gian'],
      },
    },
    TimePicker: {
      placeholder: 'Ch·ªçn th·ªùi gian',
      rangePlaceholder: ['T·ª´ th·ªùi gian', 'ƒê·∫øn th·ªùi gian'],
    },
    Calendar: {
      lang: {
        placeholder: 'Ch·ªçn ng√†y',
        rangePlaceholder: ['T·ª´ ng√†y', 'ƒê·∫øn ng√†y'],
        locale: 'vi_VN',
        today: 'H√¥m nay',
        now: 'B√¢y gi·ªù',
        backToToday: 'V·ªÅ h√¥m nay',
        ok: 'X√°c nh·∫≠n',
        clear: 'X√≥a',
        month: 'Th√°ng',
        year: 'NƒÉm',
        timeSelect: 'Ch·ªçn th·ªùi gian',
        dateSelect: 'Ch·ªçn ng√†y',
        monthSelect: 'Ch·ªçn th√°ng',
        yearSelect: 'Ch·ªçn nƒÉm',
        decadeSelect: 'Ch·ªçn th·∫≠p k·ª∑',
        yearFormat: 'YYYY',
        dateFormat: 'DD/MM/YYYY',
        dayFormat: 'DD',
        dateTimeFormat: 'DD/MM/YYYY HH:mm:ss',
        monthBeforeYear: false,
        previousMonth: 'Th√°ng tr∆∞·ªõc (PageUp)',
        nextMonth: 'Th√°ng sau (PageDown)',
        previousYear: 'NƒÉm tr∆∞·ªõc (Control + left)',
        nextYear: 'NƒÉm sau (Control + right)',
        previousDecade: 'Th·∫≠p k·ª∑ tr∆∞·ªõc',
        nextDecade: 'Th·∫≠p k·ª∑ sau',
        previousCentury: 'Th·∫ø k·ª∑ tr∆∞·ªõc',
        nextCentury: 'Th·∫ø k·ª∑ sau',
        shortWeekDays: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],
        shortMonths: ['Th1', 'Th2', 'Th3', 'Th4', 'Th5', 'Th6', 'Th7', 'Th8', 'Th9', 'Th10', 'Th11', 'Th12'],
        weekDays: ['Ch·ªß nh·∫≠t', 'Th·ª© hai', 'Th·ª© ba', 'Th·ª© t∆∞', 'Th·ª© nƒÉm', 'Th·ª© s√°u', 'Th·ª© b·∫£y'],
        months: ['Th√°ng 1', 'Th√°ng 2', 'Th√°ng 3', 'Th√°ng 4', 'Th√°ng 5', 'Th√°ng 6', 'Th√°ng 7', 'Th√°ng 8', 'Th√°ng 9', 'Th√°ng 10', 'Th√°ng 11', 'Th√°ng 12'],
      },
      timePickerLocale: {
        placeholder: 'Ch·ªçn th·ªùi gian',
      },
    },
  };

  // Debug: Ki·ªÉm tra xem antd c√≥ s·∫µn kh√¥ng
  console.log('üåê Ant Design loaded:', typeof antd !== 'undefined');
  console.log('üåê Vietnamese locale config:', vietnameseLocale);

  // Global picker roots storage
  const pickerRoots = {};
</script> 