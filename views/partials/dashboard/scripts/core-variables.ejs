<script>
  // ==================== GLOBAL VARIABLES ====================
  
  // Firebase variables
  let database = null;
  let feedbackRef = null;
  let feedbackListener = null;
  
  // Biáº¿n toÃ n cá»¥c
  var allRooms = [];
  var filteredRooms = [];

  // Global variables for context menu
  var contextMenuRoomId = null;
  var contextMenuNodeId = null;
  
  // Variables for current managed node
  var currentManagedRoomId = null;
  var currentManagedNodeId = null;
  var currentManagedNodeType = null;

  // Variables for current managed phone
  var currentManagedPhoneRoomId = null;
  var currentManagedPhoneNumber = null;

  // Variables for notification
  var currentNotificationRoomId = null;
  var currentNotificationRoomNumber = null;
  var currentNotificationPhoneNumber = null;

  // ==================== UTILITY FUNCTIONS ====================

  // Format sá»‘ Ä‘iá»‡n thoáº¡i tá»« +84 vá» 0
  function formatPhoneNumber(phone) {
    if (!phone) return '';
    // Chuyá»ƒn +84 thÃ nh 0
    if (phone.startsWith('+84')) {
      return '0' + phone.substring(3);
    }
    // Chuyá»ƒn 84 thÃ nh 0 (trÆ°á»ng há»£p khÃ´ng cÃ³ dáº¥u +)
    if (phone.startsWith('84') && phone.length >= 10) {
      return '0' + phone.substring(2);
    }
    return phone;
  }

  // Normalize phone number for storage: convert 0 prefix to +84
  function normalizePhoneForStorage(phone) {
    if (!phone) return '';
    phone = phone.trim();
    if (phone.startsWith('0') && phone.length >= 10) {
      return '+84' + phone.substring(1);
    }
    return phone;
  }

  // Debug test functions
  window.testManageModal = function() {
    console.log('ğŸ§ª Test function called');
    
    // Kiá»ƒm tra Bootstrap
    if (typeof bootstrap === 'undefined') {
      alert('âŒ Bootstrap chÆ°a Ä‘Æ°á»£c load!');
      console.error('Bootstrap is not defined');
      return;
    }
    console.log('âœ… Bootstrap loaded:', bootstrap);
    
    try {
      console.log('ğŸ§ª Testing openManageNodeModal...');
      openManageNodeModal('test_room', '101', 'test_node', 'electricity', '');
      console.log('âœ… openManageNodeModal completed');
    } catch (error) {
      console.error('âŒ Error in openManageNodeModal:', error);
      alert('Lá»—i: ' + error.message);
    }
  };

  // Debug function Ä‘á»ƒ test Firebase realtime
  window.testFirebaseRealtime = function() {
    console.log('ğŸ”¥ Testing Firebase Realtime...');
    console.log('Firebase available:', typeof firebase !== 'undefined');
    console.log('Database ref:', feedbackRef);
    console.log('Listener active:', feedbackListener !== null);
    
    if (feedbackRef) {
      console.log('ğŸ“¡ Testing direct Firebase read...');
      feedbackRef.once('value').then(snapshot => {
        console.log('âœ… Firebase read successful:', snapshot.val());
      }).catch(error => {
        console.error('âŒ Firebase read failed:', error);
      });
    }
  };
</script> 