    // ==================== NOTIFICATION FUNCTIONS ====================
    
    // Open send notification modal
    function openSendNotificationModal(roomId, roomNumber, phoneNumber) {
      try {
        currentNotificationRoomId = roomId;
        currentNotificationRoomNumber = roomNumber;
        currentNotificationPhoneNumber = phoneNumber;
        
        // Format phone number for display
        let displayPhone = phoneNumber;
        if (displayPhone.startsWith('+84')) {
          displayPhone = '0' + displayPhone.substring(3);
        } else if (displayPhone.startsWith('84') && displayPhone.length >= 10) {
          displayPhone = '0' + displayPhone.substring(2);
        }
        
        // Update modal info
        document.getElementById('notificationRoomInfo').textContent = `Ph√≤ng ${roomNumber} (${displayPhone})`;
        
        // Reset form - keep default title
        document.getElementById('notificationTitle').value = 'Qu·∫£n l√≠ to√† nh√†';
        document.getElementById('notificationMessage').value = '';
        
        // Show modal
        new bootstrap.Modal(document.getElementById('sendNotificationModal')).show();
        
      } catch (error) {
        console.error('Error opening notification modal:', error);
        alert('L·ªói khi m·ªü modal g·ª≠i th√¥ng b√°o: ' + error.message);
      }
    }
    
    // Send notification
    async function sendNotification() {
      try {
        const title = document.getElementById('notificationTitle').value.trim();
        const message = document.getElementById('notificationMessage').value.trim();
        
        // Validation
        if (!title) {
          alert('Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ th√¥ng b√°o');
          return;
        }
        
        if (!message) {
          alert('Vui l√≤ng nh·∫≠p n·ªôi dung th√¥ng b√°o');
          return;
        }
        
        if (message.length > 500) {
          alert('N·ªôi dung th√¥ng b√°o kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 500 k√Ω t·ª±');
          return;
        }
        
        // Disable button while sending
        const sendButton = document.querySelector('#sendNotificationModal .btn-primary');
        const originalText = sendButton.innerHTML;
        sendButton.disabled = true;
        sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang g·ª≠i...';
        
        // Send FCM notification via API
        console.log('üîî Sending notification:', {
          roomId: currentNotificationRoomId,
          roomNumber: currentNotificationRoomNumber,
          phoneNumber: currentNotificationPhoneNumber,
          title,
          message
        });
        
        // Call FCM API
        const response = await fetch('/api/send-notification', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            roomId: currentNotificationRoomId,
            phoneNumber: currentNotificationPhoneNumber,
            title,
            message
          })
        });
        
        // Check for authentication error
        if (response.status === 401) {
          alert('Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
          window.location.href = '/';
          return;
        }
        
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.error);
        }
        
        // Show success message
        toastManager.success(`ƒê√£ g·ª≠i th√¥ng b√°o t·ªõi ph√≤ng ${currentNotificationRoomNumber}`);
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('sendNotificationModal'));
        modal.hide();
        
        // Reset button
        sendButton.disabled = false;
        sendButton.innerHTML = originalText;
        
      } catch (error) {
        console.error('Error sending notification:', error);
        
        // Reset button
        const sendButton = document.querySelector('#sendNotificationModal .btn-primary');
        sendButton.disabled = false;
        sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> G·ª≠i th√¥ng b√°o';
        
        alert('L·ªói khi g·ª≠i th√¥ng b√°o: ' + error.message);
      }
    }

